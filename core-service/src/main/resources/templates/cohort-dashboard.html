<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
    th:replace="fragments/layout :: layout('Axon - Cohort Analysis', 'bg-gray-50 text-neutral-900', ~{::head/content()}, ~{::section})">

<head>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"
        crossorigin="anonymous"></script>
</head>
<section>
    <input type="hidden" id="activityId" th:value="${activityId}" />

    <header class="bg-white border-b border-gray-200 sticky top-0 z-10">
        <div class="max-w-[1600px] mx-auto px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="font-bold text-xl text-blue-600">Axon</div>
                <div class="h-6 w-px bg-gray-300 mx-2"></div>
                <h1 class="font-semibold text-gray-900" th:text="'Cohort Analysis: ' + ${activityName}">Cohort Analysis</h1>
            </div>
            <div class="flex items-center gap-4">
                <a th:href="@{/admin/dashboard/{id}(id=${activityId})}"
                   class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors">
                    <i class="fa-solid fa-arrow-left mr-2"></i>실시간 대시보드로 돌아가기
                </a>
                <span id="calculatedAt" class="text-sm text-gray-500">Calculated: --:--:--</span>
            </div>
        </div>
    </header>

    <main class="max-w-[1600px] mx-auto px-8 py-6 space-y-6">
        <!-- Cohort Information Banner -->
        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 border border-indigo-200 rounded-xl p-6">
            <div class="flex items-start gap-4">
                <div class="p-3 bg-indigo-100 rounded-lg text-indigo-600">
                    <i class="fa-solid fa-users text-2xl"></i>
                </div>
                <div class="flex-1">
                    <h2 class="text-xl font-bold text-gray-900 mb-2">고객 생애 가치 (LTV) 분석</h2>
                    <p class="text-gray-600 mb-4">이 Activity를 통해 획득한 고객들의 장기적인 가치와 마케팅 효율성을 분석합니다.</p>
                    <div class="grid grid-cols-4 gap-4 text-sm">
                        <div>
                            <span class="text-gray-500">Cohort Period:</span>
                            <div id="cohortPeriod" class="font-semibold text-gray-900">-</div>
                        </div>
                        <div>
                            <span class="text-gray-500">Total Customers:</span>
                            <div id="totalCustomers" class="font-semibold text-gray-900">0</div>
                        </div>
                        <div>
                            <span class="text-gray-500">Total Budget:</span>
                            <div id="totalBudget" class="font-semibold text-gray-900">₩0</div>
                        </div>
                        <div>
                            <span class="text-gray-500">Avg CAC:</span>
                            <div id="avgCACBanner" class="font-semibold text-gray-900">₩0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- LTV Metrics Grid -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <!-- 30-day LTV Card -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-2 bg-blue-50 rounded-lg text-blue-600">
                        <i class="fa-solid fa-calendar-day text-xl"></i>
                    </div>
                    <span class="text-xs font-medium text-gray-500 bg-gray-100 px-2 py-1 rounded">30일</span>
                </div>
                <div class="space-y-1">
                    <div class="text-sm text-gray-600">30-Day LTV</div>
                    <div id="ltv30d" class="text-2xl font-bold text-gray-900">₩0</div>
                    <div class="flex items-center gap-2 text-sm">
                        <span class="text-gray-500">LTV/CAC:</span>
                        <span id="ratio30d" class="font-semibold text-blue-600">0.00</span>
                    </div>
                </div>
            </div>

            <!-- 90-day LTV Card -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-2 bg-green-50 rounded-lg text-green-600">
                        <i class="fa-solid fa-calendar-week text-xl"></i>
                    </div>
                    <span class="text-xs font-medium text-gray-500 bg-gray-100 px-2 py-1 rounded">90일</span>
                </div>
                <div class="space-y-1">
                    <div class="text-sm text-gray-600">90-Day LTV</div>
                    <div id="ltv90d" class="text-2xl font-bold text-gray-900">₩0</div>
                    <div class="flex items-center gap-2 text-sm">
                        <span class="text-gray-500">LTV/CAC:</span>
                        <span id="ratio90d" class="font-semibold text-green-600">0.00</span>
                    </div>
                </div>
            </div>

            <!-- 365-day LTV Card -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-2 bg-purple-50 rounded-lg text-purple-600">
                        <i class="fa-solid fa-calendar text-xl"></i>
                    </div>
                    <span class="text-xs font-medium text-gray-500 bg-gray-100 px-2 py-1 rounded">365일</span>
                </div>
                <div class="space-y-1">
                    <div class="text-sm text-gray-600">365-Day LTV</div>
                    <div id="ltv365d" class="text-2xl font-bold text-gray-900">₩0</div>
                    <div class="flex items-center gap-2 text-sm">
                        <span class="text-gray-500">LTV/CAC:</span>
                        <span id="ratio365d" class="font-semibold text-purple-600">0.00</span>
                    </div>
                </div>
            </div>

            <!-- Current LTV Card -->
            <div class="bg-white rounded-xl shadow-sm border border-emerald-200 p-6 ring-2 ring-emerald-100">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-2 bg-emerald-50 rounded-lg text-emerald-600">
                        <i class="fa-solid fa-chart-line text-xl"></i>
                    </div>
                    <span class="text-xs font-medium text-emerald-600 bg-emerald-50 px-2 py-1 rounded">현재</span>
                </div>
                <div class="space-y-1">
                    <div class="text-sm text-gray-600">Current LTV</div>
                    <div id="ltvCurrent" class="text-2xl font-bold text-emerald-600">₩0</div>
                    <div class="flex items-center gap-2 text-sm">
                        <span class="text-gray-500">LTV/CAC:</span>
                        <span id="ratioCurrent" class="font-semibold text-emerald-600">0.00</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Customer Behavior Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Repeat Purchase Rate -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="p-2 bg-orange-50 rounded-lg text-orange-600">
                        <i class="fa-solid fa-repeat text-xl"></i>
                    </div>
                    <div>
                        <div class="text-sm text-gray-600">Repeat Purchase Rate</div>
                        <div class="text-xs text-gray-500">재구매한 고객 비율</div>
                    </div>
                </div>
                <div id="repeatPurchaseRate" class="text-3xl font-bold text-orange-600">0%</div>
            </div>

            <!-- Avg Purchase Frequency -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="p-2 bg-cyan-50 rounded-lg text-cyan-600">
                        <i class="fa-solid fa-shopping-cart text-xl"></i>
                    </div>
                    <div>
                        <div class="text-sm text-gray-600">Avg Purchase Frequency</div>
                        <div class="text-xs text-gray-500">고객당 평균 구매 횟수</div>
                    </div>
                </div>
                <div id="avgPurchaseFrequency" class="text-3xl font-bold text-cyan-600">0</div>
            </div>

            <!-- Avg Order Value -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="p-2 bg-amber-50 rounded-lg text-amber-600">
                        <i class="fa-solid fa-receipt text-xl"></i>
                    </div>
                    <div>
                        <div class="text-sm text-gray-600">Avg Order Value</div>
                        <div class="text-xs text-gray-500">평균 주문 금액</div>
                    </div>
                </div>
                <div id="avgOrderValue" class="text-3xl font-bold text-amber-600">₩0</div>
            </div>
        </div>

        <!-- LTV Growth Chart -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-900">LTV Growth Over Time</h3>
                <p class="text-sm text-gray-600">시간 경과에 따른 고객 생애 가치 성장 추이</p>
            </div>
            <div class="h-80">
                <canvas id="ltvGrowthChart"></canvas>
            </div>
        </div>

        <!-- LTV/CAC Ratio Interpretation -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-900">마케팅 효율성 해석</h3>
                <p class="text-sm text-gray-600">LTV/CAC 비율로 마케팅 ROI 평가</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                    <div class="font-semibold text-red-700 mb-1">&lt; 1.0 (손실)</div>
                    <div class="text-sm text-red-600">고객 획득 비용이 생애 가치보다 높음. 마케팅 전략 재검토 필요.</div>
                </div>
                <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <div class="font-semibold text-yellow-700 mb-1">1.0 - 3.0 (주의)</div>
                    <div class="text-sm text-yellow-600">수익은 나지만 마케팅 효율 개선이 필요한 상태.</div>
                </div>
                <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                    <div class="font-semibold text-green-700 mb-1">&gt; 3.0 (우수)</div>
                    <div class="text-sm text-green-600">건강한 마케팅 효율. 공격적인 확장 가능.</div>
                </div>
            </div>
            <div id="currentRatioInterpretation" class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-info-circle text-blue-600"></i>
                    <span class="font-semibold text-blue-900">현재 상태:</span>
                    <span id="interpretationText" class="text-blue-700">데이터 로딩 중...</span>
                </div>
            </div>
        </div>
    </main>

    <script th:src="@{/js/cohort-dashboard.js}"></script>
    <!-- Chatbot -->
    <div th:replace="fragments/chatbot :: chatbot"></div>
    <script th:src="@{/js/chatbot.js}"></script>
</section>

</html>
